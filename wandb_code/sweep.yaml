program: train_wandb_epoch_s.py
method: bayes
name: ocr-optimization
metric:
  name: loss
  goal: minimize

parameters:
  # 기본 학습 파라미터
  learning_rate:
    min: 0.0001
    max: 0.01
    distribution: log_uniform

  batch_size:
    values: [8, 16, 32]

  max_epoch:
    value: 150

  # 옵티마이저 설정
  optimizer_type:
    values: ['adam', 'adamw', 'sgd', 'radam', 'adagrad', 'adadelta']
  
  # SGD 전용 파라미터
  momentum:
    value: 0.9
    condition:
      optimizer_type: sgd
  nesterov:
    values: [true, false]
    condition:
      optimizer_type: sgd

  # 공통 옵티마이저 파라미터
  weight_decay:
    min: 0.0001
    max: 0.01
    distribution: log_uniform

  # Adadelta 전용 파라미터
  rho:
    values: [0.9, 0.95, 0.99]
    condition:
      optimizer_type: adadelta

  # 스케줄러 설정
  scheduler_type:
    values: ['cosine', 'one_cycle', 'multistep', 'reduce_on_plateau', 'exponential']
  
  # CosineAnnealingLR 전용 파라미터
  eta_min:
    value: 0.000001  # 단일 값으로 고정
    condition:
      scheduler_type: cosine

  # OneCycleLR 전용 파라미터
  pct_start:
    values: [0.2, 0.3]
    condition:
      scheduler_type: one_cycle

  # MultiStepLR 전용 파라미터
  milestones:
    values: [[50, 100], [30, 60, 90], [75, 120]]
    condition:
      scheduler_type: multistep
  gamma:
    values: [0.1, 0.5]
    condition:
      scheduler_type: multistep

  # ReduceLROnPlateau 전용 파라미터
  patience:
    values: [5, 10, 15]
    condition:
      scheduler_type: reduce_on_plateau
  factor:
    values: [0.1, 0.5]
    condition:
      scheduler_type: reduce_on_plateau

  # ExponentialLR 전용 파라미터
  exp_gamma:
    values: [0.95, 0.97, 0.99]
    condition:
      scheduler_type: exponential
  
  # OCR 특화 파라미터
  image_size:
    values: [1024, 2048]
  
  input_size:
    values: [512, 1024]

  # Loss 가중치
  cls_loss_weight:
    min: 0.5
    max: 2.0
    distribution: uniform
  
  angle_loss_weight:
    min: 0.5
    max: 2.0
    distribution: uniform
  
  iou_loss_weight:
    min: 0.5
    max: 2.0
    distribution: uniform

early_terminate:
  type: hyperband
  min_iter: 30 # 최소 30 에폭은 학습
  eta: 2 # 더 엄격한 조기 종료

command:
  - ${program}  # program에 지정된 파일 (train_wandb_epoch_s.py)
  - "--device=cuda"  # 항상 GPU 사용
  - "--num_workers=8"  # 데이터 로더의 worker 수

#python train_wandb_epoch_s.py --device=cuda --num_workers=8 --save_interval=10